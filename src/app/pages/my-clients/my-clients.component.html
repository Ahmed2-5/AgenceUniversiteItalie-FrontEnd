<app-dashboard></app-dashboard>
<div class="container-fluid">
  <header class="text-center text-light my-4">
    <h1 class="text-uppercase">My Client List</h1>
    <div class="d-flex justify-content-center align-items-center mb-3">
      <form class="search" (submit)="$event.preventDefault()">
        <input class="form-control m-auto" type="text" placeholder="Search client" [(ngModel)]="searchTerm" name="search" />
      </form>
    </div>

    <!-- Status Filter Buttons -->
    <div class="btn-group mb-4">
      <button class="btn" [ngClass]="{'btn-primary': selectedStatus === 'ALL'}" (click)="setStatusFilter('ALL')">All</button>
      <button class="btn" [ngClass]="{'btn-warning': selectedStatus === 'EN_COURS'}" (click)="setStatusFilter('EN_COURS')">En Cours</button>
      <button class="btn" [ngClass]="{'btn-success': selectedStatus === 'COMPLETE'}" (click)="setStatusFilter('COMPLETE')">Complete</button>
    </div>
  </header>
</div>

<div class="scrollable-table-container">
  <table>
    <thead>
      <tr>
        <th>Nom et prÃ©nom</th>
        <th>Pack</th>
        <th>Communication</th>
        <th>Date de dÃ©but</th>
        <th>Agent</th>
        <th>Montant Ã  payer</th>
        <th>Reste</th>
        <th>Payement</th>
        <th>Tranche 1</th>
        <th>Tranche 2</th>
        <th>Tranche 3</th>
        <th>Tranche 4</th>
        <th>Tranche 5</th>
        <th>Actions</th>

      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let client of filterClients()">
        <!-- Client Name -->
        <td>
          <a (click)="openClientDialog(client.idClients)">
            {{ client.prenomClient }} {{ client.nomClient }}
          </a>
        </td>
      
        <!-- Pack Selection -->
        <td>
          <select
            class="select-btn"
            [ngClass]="client.service?.toLowerCase()"
            [(ngModel)]="client.service"
            (change)="changePack(client)">
            <option *ngFor="let option of packOptions" [value]="option">{{ option }}</option>
          </select>
        </td>
      
        <!-- Communication -->
        <td>{{ client.communication }}</td>
      
        <!-- Date de dÃ©but -->
        <td>{{ client.payementClient?.[0]?.dateCreation || '-' }}</td>
      
        <!-- Agent -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" class="green-text">
          {{ client.assignedToTunisie?.prenom || '' }} {{ client.assignedToTunisie?.nom || '' }}
        </td>
      
        <!-- Montant Ã  payer -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" class="green-text">
          {{ client.payementClient?.[0]?.montantaTotal || '-' }}
        </td>
      
        <!-- Reste Ã  payer -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="{'light-red': client.payementClient?.[0]?.leReste > 0}">
          {{ client.payementClient?.[0]?.leReste || '-' }}
        </td>
      
        <!-- PayÃ© -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'">
          {{ client.payementClient?.[0] ? (client.payementClient[0].montantaTotal - client.payementClient[0].leReste) : '-' }}
        </td>
      
        <!-- Tranches -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="getTrancheClass(client, 0)">
          {{ getTrancheMontant(client, 0) }}
        </td>
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="getTrancheClass(client, 1)">
          {{ getTrancheMontant(client, 1) }}
        </td>
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="getTrancheClass(client, 2)">
          {{ getTrancheMontant(client, 2) }}
        </td>
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="getTrancheClass(client, 3)">
          {{ getTrancheMontant(client, 3) }}
        </td>
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'" [ngClass]="getTrancheClass(client, 4)">
          {{ getTrancheMontant(client, 4) }}
        </td>
      
        <!-- Actions -->
        <td *ngIf="role === 'ADMIN_TUNISIE' || role === 'SUPER_ADMIN'">
          <button *ngIf="!client.payementClient?.length" class="btn btn-sm btn-primary" (click)="openADDPaymenetDialog(client.idClients)">
            + Ajouter Paiement
          </button>
          <button *ngIf="client.payementClient?.length" class="icon-button" (click)="confirmArchiveBox(client.idClients)">
            ðŸ“‚
          </button>
        </td>
      
        <!-- For ADMIN_ITALIE role -->
        <ng-container *ngIf="role === 'ADMIN_ITALIE'">
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </ng-container>
      </tr>
      
    </tbody>
  </table>
</div>
